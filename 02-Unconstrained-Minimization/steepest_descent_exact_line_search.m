% Ορισμός της συνάρτησης f(x, y) και του gradient
f = @(x) x(1)^5 * exp(-x(1)^2 - x(2)^2); % Συνάρτηση f(x, y)
grad_f = @(x) [5*x(1)^4 * exp(-x(1)^2 - x(2)^2) - 2*x(1)^6 * exp(-x(1)^2 - x(2)^2); ...
               -2*x(1)^5 * x(2) * exp(-x(1)^2 - x(2)^2)]; % Παράγωγος
% Σημεία εκκίνησης
initial_points = [0, 0; -1, 1; 1, -1];
% Ανοίγουμε ένα figure για να δούμε την σύγκλιση
figure;
hold on;
% Υλοποίηση της μεθόδου μέγιστης καθόδου με γραμμική αναζήτηση
epsilon = 1e-6; % Όριο σύγκλισης
max_iter = 500; % Μέγιστος αριθμός επαναλήψεων (αύξηση)
% Αποθήκευση των σημείων ελαχίστου για εμφάνιση
min_points = [];
min_values = [];
for i = 1:size(initial_points, 1)
    x = initial_points(i, :)';
    f_values = []; % Για να αποθηκεύσουμε τις τιμές της συνάρτησης κατά την πορεία
    converged = false; % Έλεγχος αν συγκλίνουμε
    for k = 1:max_iter
        grad = grad_f(x); % Υπολογισμός του gradient
        d = -grad; % Κατεύθυνση καθόδου
        
        % Γραμμική αναζήτηση για το βήμα gamma που ελαχιστοποιεί τη συνάρτηση
        gamma = fminbnd(@(g) f(x + g*d), 0, 1); % Βρίσκουμε το βήμα με fminbnd
        
        % Ενημερώνουμε την τιμή του x
        x = x + gamma * d;
        
        % Αποθηκεύουμε την τιμή της συνάρτησης για σύγκριση
        f_values = [f_values; f(x)];
        
        % Έλεγχος σύγκλισης
        if norm(grad) < epsilon
            converged = true; % Αν συγκλίνει
            % Εκτύπωση σύγκλισης και αριθμού επαναλήψεων στην κονσόλα
            fprintf('Μέθοδος Μέγιστης Καθόδου με Γραμμική Αναζήτηση: Αρχικό σημείο: (%f, %f), Σύγκλιση σε (%f, %f) σε %d επαναλήψεις.\n', ...
                initial_points(i, 1), initial_points(i, 2), x(1), x(2), k);
            break; % Σταματάμε αν συγκλίνει
        end
    end
    
    if ~converged
        fprintf('Μέθοδος Μέγιστης Καθόδου με Γραμμική Αναζήτηση: Αρχικό σημείο: (%f, %f) ΔΕΝ συγκλίνει εντός των %d επαναλήψεων.\n', ...
            initial_points(i, 1), initial_points(i, 2), max_iter);
    end
    
    % Αποθήκευση του σημείου ελαχίστου και της τιμής της συνάρτησης
    min_points = [min_points; x'];
    min_values = [min_values; f(x)];
    
    % Εμφανίζουμε τη σύγκλιση της συνάρτησης στο διάγραμμα
    plot(1:length(f_values), f_values); % Αφαίρεσα το DisplayName για να μην εμφανίζονται τα "data"
end
% Σχεδίαση των σημείων ελαχίστου στο διάγραμμα
for i = 1:size(min_points, 1)
    % Σημείο ελαχίστου με κόκκινο χρώμα και σημείο
    plot(1, min_values(i), 'ro', 'MarkerFaceColor', 'r'); % Χωρίς να το προσθέσουμε στο legend
end
% Ρυθμίσεις του διαγράμματος
xlabel('Αριθμός Επαναλήψεων');
ylabel('Τιμή της Συνάρτησης f(x, y)');
title('Σύγκλιση Συνάρτησης με Μέθοδο Μέγιστης Καθόδου και Γραμμική Αναζήτηση');
% Εμφανίζουμε μόνο τα σημεία εκκίνησης στο legend (χωρίς "data 1", "data 2", "data 3")
legend({'Point (0, 0)', 'Point (-1, 1)', 'Point (1, -1)'}, 'Location', 'best');
hold off;